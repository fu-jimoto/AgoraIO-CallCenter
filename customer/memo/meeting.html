

<!DOCTYPE html>
<html>
<head>接続中
<title>Meeting</title>
<script src="../AgoraRTCSDK-2.4.1.js"></script>
</head>

<body>
<div id="video" style="margin:0 auto;">
    <div id="local_video" style="float:right;width:210px;height:147px;display:inline-block;"></div>
    <div id="local_screen" style="float:right;width:210px;height:147px;display:inline-block;"></div>
</div>

<div>
    <button id="muteCamera">緊急対応要請</button>
    <button id="callT-icu">緊急対応要請中</button>
    <button id="underCalling">T-ICU呼び出し中</button>
    <button id="cutMeeting">切断</button>
</div>

<script language="javascript">

var appId = "62ec47cc139b4f12a05b82d2ffd91c47";
var channelKey = null;
var channelName = "icu";
var videoUid = 123;

var screenUid = 1234567890;
var videoClient, screenClient, videoLocalStream, screenLocalStream, camera, microphone;
/*
//20181025/26_Create a Video Client
videoClient = AgoraRTC.createClient({mode: "live", codec: "h264"});
//20181026_Initialize the Client
videoClient.init(appId, function(){
    console.log("AgoraRTC videoClient initialized");
    //20181026_Join a Channel
    //20181029_joinの引数を変数に変更(uidはセッションで取得した値に)
    videoClient.join(channelKey, channelName, videoUid, function(uid){
        console.log("User " + videoUid + " join channel successfully");
        //20181026_Create a stream
        videoLocalStream = AgoraRTC.createStream({
            streamID: videoUid,
            audio: true,
            video: true,
            screen: false
        });

        //Initialize the stream
        videoLocalStream.init(function(){
            console.log("getUserMedia successfully");
            //20181029_Play the stream
            videoLocalStream.play("local_video");

            //20181030_Publish the local stream
            videoClient.publish(videoLocalStream, function(err){
                console.log("Publish video local stream error: "+err);
            });

            videoClient.on("stream-published", function(evt){
                console.log("Publish video local stream successfuly");
            });
        }, function(err){
            console.log("getUserMedia failed", err);
        });
    
    }, function(err){
        console.log("Join channel failed", err);
    });
}, function(err){
    console.log("AgoraRTC videoClient init failed", err);
});
*/

//20181105_Create a Screen Client
screenClient = AgoraRTC.createClient({mode:"live",codec:"h264"});
screenClient.init(appId, function(){
    console.log("AgoraRTC screenClient initialized");
    screenClient.join(channelKey, channelName,screenUid,function(uid){
        console.log("User " + screenUid + " join channel successfully");
        //20181105_Create a Screen Stream
        screenLocalStream = AgoraRTC.createStream({
            streamID: screenUid,
            audio: false,
            video: false,
            screen: true,
            mediaSource: "window"
        });

        screenLocalStream.init(function(){
            console.log("getUserMedia successfully");
            screenLocalStream.play("local_screen");

            screenClient.publish(screenLocalStream, function(err){
                console.log("Publish screen local stream error: "+err);
            });
            screenClient.on("stream-published", function(evt){
                console.log("Publish screen local stream successfuly");
            });
        }, function(err){
            console.log("getUserMedia failed", err);
        });
    }, function(err){
        console.log("Join channek failed", err);
    });
}, function(err){
    console.log("AgoraRTC screenClient init failed", err);
});

</script>
</body>
</html>